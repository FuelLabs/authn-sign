<html>

<head>
  <title>auth-sign example</title>
</head>

<body>
  <script type="module">
    import authn from './authn-sign.js';
    const { register, sign, verify, utils } = authn;

    // Register your account.
    const account = await register('username_1');

    // Some transaction hash.
    const transaction_hash = '0xb4f62ae3e337421868782a88ff7d81a8bf44ef6722dfcd0c70d08a0adc25663d';

    // Sign the transaction hash.
    const signature = await sign(account, transaction_hash);

    // This would happen on chain.
    const signedData = signature.clientData.preChallenge
      + utils.hexToBase64(transaction_hash).slice(0, -1)
      + signature.clientData.postChallenge;
    const clientDataHash = utils.bufferToHex(await utils.sha256(utils.toBuffer(signedData)));
    const message = utils.concatHexStrings(signature.authenticatorData, clientDataHash);
    // const messageHash = utils.bufferToHex(await utils.sha256(message));

    // This P-256 verficiation would also happen on chain.
    const is_verified = await verify({
      publicKey: account.publicKey,
      message: utils.bufferToHex(message),
      signature: signature.signature,
    });

    // Should be true!
    console.log(is_verified);
  </script>
</body>

</html>