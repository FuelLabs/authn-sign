<html>
    <head></head>
    <body>
        <script type="module">
            import Account, { hexToBase64, bufferToHex, sha256, toBuffer, parseHexString, concatHexStrings } from "./index.js";

            (async () => {
                const account = new Account();

                console.log(await account.register('account_1', { debug: true }));

                const challenge = '0x32';

                const signature = await account.sign(challenge, { debug: true });

                console.log(signature);

                // This would happen on chain.
                const signedData = signature.clientData.preChallenge 
                    + hexToBase64(challenge).slice(0, -2) // remove last character
                    + signature.clientData.postChallenge;
                const clientDataHash = bufferToHex(await sha256(toBuffer(signedData)));

                const message = bufferToHex(concatHexStrings(signature.authenticatorData, clientDataHash));
                // const messageHash = bufferToHex(await utils.sha256(message));

                console.log(signedData, message);

                console.log(account.publicKey);

                console.log(await account.verify(message, signature.signature));
            })()
            .then(console.log)
            .catch(console.error);

            /*
            function toBuffer(txt) {
                return Uint8Array.from(txt, c => c.charCodeAt(0)).buffer; // @ts-nocheck
            }

            const publicKeyCredentialCreationOptions = {
                challenge: toBuffer('random-challenge-base64-encoded'),
                rp: {
                    id: window.location.hostname,
                    name: window.location.hostname,
                },
                user: {
                    id: Uint8Array.from("UZSL85T9AFC", c => c.charCodeAt(0)),
                    name: "lee@webauthn.guide",
                    displayName: "Lee",
                },
                allowCredentials: [{
                    type: 'public-key',
                    transports: ["internal", "hybrid"],
                }],
                pubKeyCredParams: [{alg: -7, type: "public-key"}], // P-256
                "authenticatorSelection": {
                    "userVerification": "required",
                    "authenticatorAttachment": "platform",
                    "residentKey": "preferred",
                    "requireResidentKey": false
                },
                "attestation": "none",
                timeout: 60000,
            };
           
            (async () => {
                const credential = await navigator.credentials.create({
                    publicKey: publicKeyCredentialCreationOptions,
                });

                console.log(credential);

                JSON.stringify(credential);
            })();
            */
        </script>
    </body>
</html>